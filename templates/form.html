{% extends "base.html" %}
{% block head_extra %}
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
{% endblock %}

{% block content %}
<h1>{% if post %}編集{% else %}新規投稿{% endif %}</h1>
<form method="post" enctype="multipart/form-data">
  <input type="text" name="title" placeholder="タイトル" value="{{ post.title if post else '' }}">
  <div id="editor" style="min-height:200px;">
    {% if post %}{{ post.content | safe }}{% endif %}
  </div>
  <input type="hidden" name="content" id="hiddenContent">
  <p>画像選択: <input type="file" name="image" accept="image/*">
    {% if post and post.image_filename %}
      <br>現在の画像: {{ post.image_filename }}
      <img src="{{ url_for('static', filename='uploads/' ~ post.image_filename) }}" width="200">
    {% endif %}
  </p>
  <button type="submit">{% if post %}更新{% else %}投稿{% endif %}</button>
</form>
{% endblock %}

{% block scripts %}
<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
<script>
  var quill = new Quill('#editor', { theme: 'snow' });
  var form = document.querySelector('form');
  form.onsubmit = function() {
    document.getElementById('hiddenContent').value = quill.root.innerHTML;
  }
</script>
{% endblock %}
