{% extends "base.html" %}
{% block head_extra %}
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
{% endblock %}

{% block content %}
  <h1>{% if post %}投稿を編集{% else %}新規投稿{% endif %}</h1>
  <form id="postForm" method="post" enctype="multipart/form-data">
    <input type="text" name="title" placeholder="タイトル" value="{{ post.title if post else '' }}" />

    <!-- editor -->
    <div class="card">
      <div id="editor" style="min-height:240px;">
        {% if post %}
          {{ post.content | safe }}
        {% endif %}
      </div>
    </div>

    <!-- 隠しフィールドにHTMLを入れて送る -->
    <input type="hidden" name="content" id="hiddenContent" />

    <!-- 画像選択 -->
    <p style="margin-top:12px">
      画像を選択（任意）：
      <input type="file" name="image" accept="image/*">
      {% if post and post.image_filename %}
        <br>現在の画像: {{ post.image_filename }}
        <img src="{{ url_for('static', filename='uploads/' ~ post.image_filename) }}" width="200">
      {% endif %}
    </p>

    <p style="margin-top:12px">
      <button class="btn" type="submit">{% if post %}更新{% else %}投稿{% endif %}</button>
      <a href="{{ url_for('index') }}" style="margin-left:12px">キャンセル</a>
    </p>
  </form>
{% endblock %}

{% block scripts %}
  <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
  <script>
    var quill = new Quill('#editor', {
      theme: 'snow',
      modules: {
        toolbar: [
          [{ 'header': [1, 2, 3, false] }],
          ['bold', 'italic', 'underline', 'strike'],
          [{ 'list': 'ordered' }, { 'list': 'bullet' }],
          ['blockquote', 'code-block'],
          ['link', 'image'],
          [{ 'align': [] }],
          [{ 'size': ['small', false, 'large', 'huge'] }],
          ['clean']
        ]
      }
    });

    document.getElementById('postForm').addEventListener('submit', function(e){
      document.getElementById('hiddenContent').value = quill.root.innerHTML;
    });
  </script>
{% endblock %}
